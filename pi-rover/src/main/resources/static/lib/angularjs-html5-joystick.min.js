!function(){"use strict";angular.module("angularjs-html5-joystick",[])}(),function(){"use strict";var a=angular.module("angularjs-html5-joystick"),b=function(){var a=function(a,b){var c=document.getElementById(a),d={radius:c.width<c.height?c.width/2:c.height/2,outerRadius:0,innerRadius:0,center:{x:c.width/2,y:c.height/2}};d.outerRadius=2*d.radius/3,d.innerRadius=d.outerRadius/2;var e={canvasId:a,canvas:c,bounds:d,vector:{angle:0,magnitude:0},drawCallback:b};return e},b=function(a){var b=a.canvas.getContext("2d");if(b.clearRect(0,0,a.canvas.width,a.canvas.height),a.drawCallback)a.drawCallback({ctx:b,bounds:a.bounds,vector:a.vector});else{b.beginPath(),b.arc(a.bounds.center.x,a.bounds.center.y,a.bounds.outerRadius,0,2*Math.PI),b.stroke();var c=e(a.bounds.outerRadius,a.vector),d=f(a.bounds.center,c);b.fillStyle="green",b.beginPath(),b.arc(d.x,d.y,a.bounds.innerRadius,0,2*Math.PI),b.fill()}},c=function(a,b){var c={x:b.x-a.x,y:-1*(b.y-a.y)};return c},d=function(a,b){var c={angle:Math.atan2(b.y,b.x),magnitude:Math.sqrt(b.x*b.x+b.y*b.y)/a};return c.magnitude>1&&(c.magnitude=1),c},e=function(a,b){var c=b.magnitude*a,d={x:c*Math.cos(b.angle),y:c*Math.sin(b.angle)};return d},f=function(a,b){var c={x:b.x+a.x,y:a.y-b.y};return c},g=function(a){b(a)},h=function(a,b){var e=c(a.bounds.center,b);a.vector=d(a.bounds.outerRadius,e),g(a)},i=function(a){j(a)},j=function(a){a.vector.angle=0,a.vector.magnitude=0,g(a)};return{createElementDetails:a,reset:j,touchMove:h,touchEnd:i}};a.factory("angularjsHtml5JoystickService",[b])}(),function(){"use strict";var a=angular.module("angularjs-html5-joystick"),b=function(a){return{restrict:"A",scope:{id:"@",onMove:"&",draw:"&?"},link:function(b,c,d){b.elementDetails=a.createElementDetails(d.id,b.draw),c.on("touchmove",function(d){d.preventDefault();var e=window.event;if(e.targetTouches.length>0){var f=e.targetTouches[0],g=c.offset(),h=f.pageX-g.left,i=f.pageY-g.top,j={x:h,y:i};a.touchMove(b.elementDetails,j),b.onMove({vector:b.elementDetails.vector})}}),c.on("touchend",function(c){c.preventDefault(),a.touchEnd(b.elementDetails),b.onMove({vector:b.elementDetails.vector})}),a.reset(b.elementDetails)}}};a.directive("angularjsHtml5Joystick",["angularjsHtml5JoystickService",b])}();